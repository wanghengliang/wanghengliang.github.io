I"‹#<p>ä¿ç•™æ—§ç‰ˆæœ¬å®‰è£…æ–°ç‰ˆæœ¬mysql</p>

<h3 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h3>

<h4 id="ä¸‹è½½æ–°ç‰ˆæœ¬mysql">ä¸‹è½½æ–°ç‰ˆæœ¬MySQL</h4>
<p>ä¸‹è½½åœ°å€ï¼šhttp://www.mysql.com/downloads/</p>

<p>ä¾æ¬¡é€‰æ‹© MySQL Community Edition (GPL) MySQLç¤¾åŒºç‰ˆï¼ˆGPLï¼‰â€“&gt; MySQL Community Server (GPL) MySQLç¤¾åŒºæœåŠ¡å™¨ï¼ˆGPLï¼‰</p>

<p>æ“ä½œç³»ç»Ÿé€‰æ‹©ï¼šSource Code</p>

<p>ä¸‹è½½å¦‚ä¸‹ç‰ˆæœ¬ï¼šGeneric Linux (Architecture Independent), Compressed TAR Archive Includes Boost Headers</p>
<blockquote>
  <p>é€‰æ‹©åŒ…å«Boostçš„Generic Linuxç‰ˆæœ¬ï¼Œåº”ä¸ºæ¯ä¸ªç‰ˆæœ¬å¯¹åº”çš„Boostç‰ˆæœ¬æœ‰è¦æ±‚ï¼Œç›´æ¥é€‰æ‹©åŒ…å«Boostçš„ç‰ˆæœ¬ä¸ä¼šå‡ºç°ç‰ˆæœ¬ä¸å¯¹åº”çš„æƒ…å†µ</p>
</blockquote>

<h4 id="æ·»åŠ ç³»ç»Ÿmysqlç»„å’Œmysqlç”¨æˆ·">æ·»åŠ ç³»ç»Ÿmysqlç»„å’Œmysqlç”¨æˆ·</h4>

<p>æŸ¥çœ‹æ˜¯å¦æœ‰mysqlç»„å’Œmysqlç”¨æˆ·ï¼Œæ²¡æœ‰åˆ™æ·»åŠ </p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># cat /etc/passwd
# cat /etc/group
# groupadd mysql
# useradd -r -g mysql mysql
</code></pre></div></div>

<h4 id="åˆ›å»ºå®‰è£…ç›®å½•å¹¶ä¿®æ”¹ç›®å½•æ‹¥æœ‰è€…">åˆ›å»ºå®‰è£…ç›®å½•å¹¶ä¿®æ”¹ç›®å½•æ‹¥æœ‰è€…</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mkdir /usr/local/mysql5727
# mkdir /data/mysql5727
# å°ç‰ˆæœ¬æ›´æ–°å¯ä»¥ç›´æ¥å¤åˆ¶åŸæ¥ç‰ˆæœ¬çš„æ•°æ®æ–‡ä»¶
# cp -r /data/mysql5726 /data/mysql5726bak    å®‰è£…å¥½æ–°ç‰ˆæœ¬åé‡å‘½å mv /data/mysql5726 /data/mysql5727
# 
# chown -R mysql:mysql /usr/local/mysql5727
# chown -R mysql:mysql /data/mysql5727

# mkdir /etc/mysql5727
</code></pre></div></div>

<h4 id="å¤‡ä»½mysql">å¤‡ä»½MySQL</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/local/mysql/bin/mysqldump -uroot -p db_name &gt; db_bak_db_name_20160822.sql
</code></pre></div></div>

<h3 id="å®‰è£…cmake">å®‰è£…cmake</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># wget https://cmake.org/files/v3.13/cmake-3.13.3.tar.gz
# tar -xzvf cmake-3.13.3.tar.gz
# cd cmake-3.13.3
./bootstrap
gmake &amp;&amp; gmake install
</code></pre></div></div>

<h3 id="å®‰è£…æ–°ç‰ˆæœ¬mysql">å®‰è£…æ–°ç‰ˆæœ¬MySQL</h3>
<p>ç„¶åè§£å‹å¹¶è·³è½¬åˆ°è§£å‹ç›®å½•è¿›è¡Œç¼–è¯‘å®‰è£…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># tar -xzvf mysql-boost-5.7.27.tar.gz
# cd mysql-boost-5.7.27

# cmake . \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql5727 \
-DMYSQL_DATADIR=/data/mysql5727 \
-DMYSQL_UNIX_ADDR=/data/mysql5727/mysql.sock \
-DSYSCONFDIR=/etc/mysql5727 \
-DMYSQL_USER=mysql \
-DMYSQL_TCP_PORT=3306 \
-DDEFAULT_CHARSET=utf8mb4 \
-DDEFAULT_COLLATION=utf8mb4_general_ci \
-DEXTRA_CHARSETS=all \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DWITH_MEMORY_STORAGE_ENGINE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DWITH_READLINE=1 \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_EMBEDDED_SERVER=1 \
-DWITH_BOOST=boost/boost_1_59_0

# make &amp;&amp; make install
</code></pre></div></div>

<blockquote>
  <p>DWITH_BOOSTå‚æ•°å¯¹åº”çš„æ˜¯åˆšåˆšè§£å‹åçš„boostç›®å½•</p>
</blockquote>

<blockquote>
  <p>DSYSCONFDIRå‚æ•°ä¸ºé…ç½®æ–‡ä»¶my.cnfå­˜æ”¾è·¯å¾„</p>
</blockquote>

<p>æ·»åŠ mysqlé…ç½®æ–‡ä»¶</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vi /etc/mysql5727/my.cnf
...
</code></pre></div></div>

<p>æ·»åŠ å¯åŠ¨é¡¹é…ç½®å¹¶åˆ é™¤åŸæ¥çš„å¯åŠ¨é¡¹</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># cd /usr/local/mysql5727/support-files
# cp mysql.server /etc/init.d/mysql5727
# mv /etc/init.d/mysql5726 /data/db_bak/
</code></pre></div></div>

<p>ä¿®æ”¹/etc/init.d/mysql5727æ–‡ä»¶ä¸­çš„å¦‚ä¸‹ä»£ç </p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vi /etc/init.d/mysql5727


basedir=/usr/local/mysql5727
datadir=/data/mysql5727
</code></pre></div></div>

<p>è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡å¹¶åˆ é™¤åŸæ¥çš„æœåŠ¡</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># chkconfig --add mysql5727
# chkconfig --del mysql5726
</code></pre></div></div>

<p>ä¿®æ”¹aliasé‡æ–°æŒ‡å®šmysqlå¯åŠ¨ç¨‹åº</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vi ~ /.bash_profile

alias mysql="/usr/local/mysql5727/bin/mysql"
alias mysqldump="/usr/local/mysql5727/bin/mysqldump"


# source ~ /.bash_profile
</code></pre></div></div>

<h4 id="å°ç‰ˆæœ¬å‡çº§">å°ç‰ˆæœ¬å‡çº§</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## åœæ­¢è€ç‰ˆæœ¬
# service mysql5726 stop

## æ‹·è´æ•°æ®æ–‡ä»¶(ä¿ç•™åŸç‰ˆæœ¬æ•°æ®)
# cp -r /data/mysql5726 /data/mysql5727
# chown -R mysql:mysql /usr/local/mysql5727
# chown -R mysql:mysql /data/mysql5727

## å¯åŠ¨æ–°ç‰ˆæœ¬
# service mysql5727 start

## æ›´æ–°ä¿¡æ¯
# cd /usr/local/mysql5727/bin
# ./mysqld_safe --user=mysql --socket=/data/mysql5727/mysql.sock -p --skip-grant-tables  --datadir=/data/mysql5727/data
# ./mysql_upgrade -uroot -p -S /data/mysql5727/mysql.sock
## é‡å¯æ–°ç‰ˆæœ¬
# service mysql5727 restart
...

## å› ä¸ºç”¨çš„åŸæ¥æ•°æ®,å¯†ç è¿˜æ˜¯åŸæ¥çš„å¯†ç 
# /usr/local/mysql5727/bin/mysql -uroot -p
Enter password: 
...
mysql&gt;

</code></pre></div></div>

<h4 id="å¤§ç‰ˆæœ¬å‡çº§">å¤§ç‰ˆæœ¬å‡çº§</h4>

<p>åˆå§‹åŒ–mysqld</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql5725 --datadir=/data/mysql5725
</code></pre></div></div>

<blockquote>
  <p>åˆå§‹åŒ–åä¼šç”Ÿæˆé»˜è®¤ä¸´æ—¶å¯†ç ï¼Œè®°ä½å¯†ç ä¸€ä¼šå„¿ç™»å½•æ—¶éœ€è¦ï¼šA temporary password is generated for root@localhost: ET#&amp;dQs_p22%</p>
</blockquote>

<p>å¯åŠ¨æ–°ç‰ˆæœ¬</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service mysql5726 start
</code></pre></div></div>

<p>è¾“å…¥ä¹‹å‰åˆå§‹åŒ–æ—¶å€™çš„å¯†ç è¿›å…¥ï¼Œé¦–æ¬¡ä½¿ç”¨ä¼šæœ‰æç¤ºä¿®æ”¹å¯†ç </p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'abc1';
mysql&gt; FLUSH PRIVILEGES;
</code></pre></div></div>

<h3 id="æµ‹è¯•mysql">æµ‹è¯•MySQL</h3>
<p>é‡å¯å¹¶æµ‹è¯•</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># service mysql5726 restart
...

# /usr/local/mysql5726/bin/mysql -uroot -p     
Enter password: 
...
mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows in set (0.00 sec)

</code></pre></div></div>

<p>æ—§ç‰ˆæœ¬æµ‹è¯•</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mysql -uroot -p
Enter password: 
...
mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows in set (0.00 sec)
</code></pre></div></div>

<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯æŸ¥çœ‹ä¸¤ä¸ªmysqlçš„ç«¯å£å’Œè¿æ¥æ•°ä¿¡æ¯</p>

<p>æŸ¥è¯¢ç«¯å£</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; show global variables like 'port';
</code></pre></div></div>

<p>æŸ¥è¯¢è¿æ¥æ•°</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; show processlist;
</code></pre></div></div>

<h3 id="åˆ é™¤æ—§ç‰ˆæœ¬">åˆ é™¤æ—§ç‰ˆæœ¬</h3>
<p>å¦‚æœæ˜¯å‡çº§å¯è¿ç§»æ•°æ®ååˆ é™¤æ—§ç‰ˆæœ¬</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rpm -qa | grep mysql
mysql-connector-odbc-5.1.5r1144-7.el6.x86_64
mysql-libs-5.1.71-1.el6.x86_64
mysql-5.1.71-1.el6.x86_64
mysql-server-5.1.71-1.el6.x86_64
</code></pre></div></div>

<p>é€ä¸€å¸è½½</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rpm -e mysql-connector-odbc-5.1.5r1144-7.el6.x86_64
# rpm -e mysql-libs-5.1.71-1.el6.x86_64
# rpm -e mysql-5.1.71-1.el6.x86_64
# rpm -e mysql-server-5.1.71-1.el6.x86_64
</code></pre></div></div>

<p>//ç™»é™†mysql
mysql -uroot -p
-bash: mysql: command not found
//åŸå› :è¿™æ˜¯ç”±äºç³»ç»Ÿé»˜è®¤ä¼šæŸ¥æ‰¾/usr/binä¸‹çš„å‘½ä»¤ï¼Œå¦‚æœè¿™ä¸ªå‘½ä»¤ä¸åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œå½“ç„¶ä¼šæ‰¾ä¸åˆ°å‘½ä»¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ˜ å°„ä¸€ä¸ªé“¾æ¥åˆ°/usr/binç›®å½•ä¸‹ï¼Œç›¸å½“äºå»ºç«‹ä¸€ä¸ªé“¾æ¥æ–‡ä»¶ã€‚
ln -s /data/db/mysql/bin/mysql /usr/bin</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'abc1';
mysql&gt; FLUSH PRIVILEGES;
</code></pre></div></div>

<p>é€ä¸€å¸è½½</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rpm -e mysql-community-server-5.7.22-1.el7.x86_64
# rpm -e mysql-community-client-5.7.22-1.el7.x86_64
# rpm -e mysql-community-libs-5.7.22-1.el7.x86_64
# rpm -e mysql-community-common-5.7.22-1.el7.x86_64
</code></pre></div></div>
:ET